<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Hello wasm-pack!</title>
  <style>
    body {
      margin: 2px;
      padding: 2px;
      font-family: sans-serif;
      background-color: #ffffff;
      text-decoration: none;

    }

    * {
      text-decoration: none;
    }

    .result_container {
      width: 100%;
      height: 60%;
      overflow: scroll;
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
      border: 3px solid rgb(0, 0, 0);
    }

    .raw-text {
      white-space: pre-wrap;
      border: 2px solid #ccc;
      margin: 10px;
      width: 40%;
      height: 100%;
      overflow: auto;
      display: flex;
    }

    .file_link {
      margin: 2px;

    }

    .file_list {
      border: 2px solid rgb(0, 0, 0);
      margin: 2px;
      padding: 2px;
      display: block;
      width: 100%;
      overflow: scroll;
    }

    .list-link-fail {

      background-color: aliceblue;
      color: red;
    }

    .list-link-success {
      color: black;
      
      background-color: green;
    }
  </style>
  <script src="./bootstrap.js" type="text/javascript"></script>
  <script type="text/javascript">
    function copytext() {
      let text = document.getElementById("result");
      navigator.clipboard.writeText(text.innerHTML);
      document.getElementById("clicked").innerHTML = "Copied!";
    };
    function clearresult() {
      console.log("clearing now");
      document.getElementById("result").innerHTML = "";
      let link_list = document.getElementById("file_list").children;
      for (let i = 0; i < link_list.length; i++) {
        link_list[i].className = "file_link";
      }
    };
    function update() {
      document.getElementById("log").innerHTML = "Updating the mtx repository";
      console.log("updating now");
      let http_get = new XMLHttpRequest();
      http_get.open("GET", "https://research.thesjq.com/updategit/", true);
      console.log("sending request");
      http_get.send();
      http_get.onreadystatechange = function () {

        document.getElementById("log").innerHTML = "Updated!" + http_get.responseText;
        updatelist();
      }

    }
  </script>

</head>

<body>
  <noscript>This page contains webassembly and javascript content, please enable javascript in your browser.</noscript>
  <h1>the spmm_pim simulator <a href="https://github.com/shenjiangqiu/spmm_pim">https://github.com/shenjiangqiu/spmm_pim</a></h1>
  <a>type the mtx file name and click run to run a single graph</a><br>
  <a>clear the input field and click run to run all the benches</a><br>
  <a>click update to update the mtx repository</a><br>
  <a>click copy to copy the result</a><br>
  <a>upload the mtx file to git repo: <a href="https://github.com/shenjiangqiu/mtx_server/tree/master/mtx">https://github.com/shenjiangqiu/mtx_server/tree/master/mtx</a> and click update to update the list of banchmark</a><br>
  <input type="text" id="input" value="test.mtx">
  <button id="run">click to run</button>
  <button id="copy" onclick="copytext();">copy</button>
  <button id="clear" onclick="console.log('clearing');clearresult();">clear</button>
  <button id="update" onclick="console.log('updating');update();">update file list</button>
  <a id="clicked"></a>
  <div id="file_list" class="file_list"></div>
  <div class="result_container">
    <div id="result" class="raw-text">no result yet</div>
    <div id="log" class="raw-text">no log yet</div>
    <div id="ok_list" class="raw-text">no result yet</div>
    <div id="err_list" class="raw-text">no result yet</div>
  </div>

  <script>
    function updatelist() {
      console.log("updating list");
      let json_http = new XMLHttpRequest();
      json_http.open("GET", "https://research.thesjq.com/filelist", true);
      json_http.send();
      json_http.onreadystatechange = function () {
        if (json_http.readyState == 4 && json_http.status == 200) {
          let json_data = JSON.parse(json_http.responseText);
          let file_list = document.getElementById("file_list");
          file_list.innerHTML = "";
          
          for (let i = 0; i < json_data.length; i++) {
            let file_name = json_data[i];
            let file_link = document.createElement("button");
            file_link.className = "file_link";
            file_link.setAttribute("onclick", "document.getElementById('input').value='" + file_name + "';document.getElementById('run').click();");
            file_link.innerHTML = file_name;
            file_link.id = "link_" + i;
            file_list.appendChild(file_link);
          }
        }
      }
    }
    updatelist();
  </script>
</body>

</html>